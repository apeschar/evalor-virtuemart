#!/bin/bash
set -eu

cd `dirname "$0"`
cd ..

zip="zip -q -9"
ext=$PWD/extension
dist=$PWD/dist

rm -rf $dist/packages
mkdir -p $dist
mkdir -p $dist/packages
rm -f $dist/pkg_webwinkelkeur.zip

cd $ext/com_webwinkelkeur
find . -not -name '.*.swp' | xargs $zip $dist/packages/com_webwinkelkeur.zip

cd $ext/plg_sys_webwinkelkeur
find . -not -name '.*.swp' | xargs $zip $dist/packages/plg_sys_webwinkelkeur.zip

cd $ext
$zip $dist/pkg_webwinkelkeur.zip pkg_webwinkelkeur.xml

cd $dist
$zip -0 $dist/pkg_webwinkelkeur.zip packages packages/com_webwinkelkeur.zip
$zip -0 $dist/pkg_webwinkelkeur.zip packages packages/plg_sys_webwinkelkeur.zip

cd $dist
unzip -l packages/com_webwinkelkeur.zip
unzip -l packages/plg_sys_webwinkelkeur.zip
unzip -l pkg_webwinkelkeur.zip
